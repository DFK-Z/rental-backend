generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

model User {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  name         String
  email        String  @unique
  password     String
  refreshToken String? @map("refresh_token")
  role         Role    @default(USER)

  equipments Equipment[]
  categories Category[]

  @@map("users")
}

model Equipment {
  id           Int      @id @default(autoincrement())
  title        String
  description  String
  priceCents   Int      @map("price_cents") // ТЗ: цена в копейках/центах
  depositCents Int?     @map("deposit_cents") // ТЗ: залог
  categoryId   Int      @map("category_id")
  status       String   @default("available") // available, rented, maintenance
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Связи
  category Category @relation(fields: [categoryId], references: [id])
  User     User?    @relation(fields: [userId], references: [id])
  userId   Int?

  @@map("equipment")
}

model Category {
  id        Int      @id @default(autoincrement())
  name      String
  parentId  Int?     @map("parent_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Связи
  parent    Category?   @relation("CategoryToCategory", fields: [parentId], references: [id])
  children  Category[]  @relation("CategoryToCategory")
  equipment Equipment[]
  User      User?       @relation(fields: [userId], references: [id])
  userId    Int?

  @@map("categories")
}
